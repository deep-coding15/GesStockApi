# Nom du workflow (visible dans l‚Äôonglet "Actions" de GitHub)
name: GesStocApi Continuous Integration

# D√©clencheurs du workflow
on:
  # Le workflow se lance automatiquement :
  push:
    # Quand on pousse du code sur la branche "main"
    branches: ["main"]
  pull_request:
    # Quand on ouvre une Pull Request vers "main"
    branches: ["main"]

  # D√©finition des jobs (un workflow peut contenir plusieurs jobs)

jobs:
  # Nom du job (identifiant interne)
  build:
    # Machine virtuelle utilis√©e par GitHub pour ex√©cuter le job
    # ubuntu-latest = serveur Linux temporaire propre
    runs-on: ubuntu-latest

    # √âtapes ex√©cut√©es dans l‚Äôordre
    steps:
      # 1 - r√©cup√©rer ton code depuis le repository
      - name: üì• Checkout repository
        uses: actions/checkout@v3
      # "uses" signifie qu‚Äôon utilise une action publique d√©j√† existante
      # actions/checkout permet de cloner ton repo dans la machine virtuelle

      # 2 - Installer Java
      - name: ‚òï Set up JDK 17
        uses: actions/setup-java@v3
        with:
          # Distribution Temurin (ancienne AdoptOpenJDK)
          distribution: "temurin"
          # Version Java √† installer
          java-version: "17"
      # Cette √©tape installe Java 17 sur la machine Linux temporaire

      # 3 - V√©rifier la version Java (option p√©dagogique)
      - name: üîç Verify Java version
        run: java -version
      # "run" signifie qu‚Äôon ex√©cute une commande shell Linux

      # 4 - Construire le projet et ex√©cuter les tests
      - name: üèóÔ∏è Build and Run Tests with Maven
        run: mvn clean verify
    # mvn clean :
    #   supprime le dossier target/ (ancien build)
    #
    # mvn verify :
    #   compile le projet
    #   ex√©cute les tests unitaires
    #   v√©rifie que tout passe correctement
    #
    # Si un seul test √©choue :
    #   le job √©choue
    #   le workflow devient rouge
